<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Bootstrap CSS -->
    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/style.css" rel="stylesheet">
</head>

<body>
    <div class='customAlert'>
        <p class='message'></p>
        <input type='button' class='confirmButton' value='Gerai'>
    </div>
    <div class="container-fluid header-top">
        <a href="../index.html"><img class="header_logo img-fluid" src="../img_lessons/100_small1.png"></a>
        <div class="progress-container">
            <ul style="text-align: center;">
                <li>
                    <a href="level2-1.html">1</a>
                </li>
                <li>
                    <a href="level2-2.html">2</a>
                </li>
                <li>
                    <a href="level2-3.html">3</a>
                </li>
                <li>
                    <a href="level2-4.html">4</a>
                </li>
                <li>
                    <a href="level2-5.html">5</a>
                </li>
                <li>
                    <a class="active" href="level2-6.html">6</a>
                </li>
                <li>
                    <a href="level2-7.html">7</a>
                </li>
                <li>
                    <a href="level2-8.html">8</a>
                </li>
                <li>
                    <a href="level2-9.html">9</a>
                </li>
                <li>
                    <a href="level2-10.html">10</a>
                </li>
            </ul>
        </div>
    </div>
    <div class="container-fluid working-space">
        <div class="row" style="padding: 10px;">
            <div class="col-md-5">
                <h4>6. Rūta Meilutytė: olimpinės purslynės</h4></div>
            <div class=" col-md-7" id="task"> Padėkime Rūtai pakartoti jos olimpinį rekordą! Šioje užduotyje tau reikės sukurti naują komandą „Plaukti“. Į ją įdėk blokelius, apibūdinančius plaukimo judesius bei judesių greitį. Padaryk taip, jog plaukikės greitį galėtum padidinti paspaudęs ant ekrano, o pasiekus jo kraštą - apsuk.
                <a href="javascript:void(0)" onclick="changeVideo('9j-wTK2C-Sc')">Užduoties video</a> </div>
        </div>
        <div class="row" style="padding: 10px">
            <div class="col  ">
                <div id="preview">
                    <canvas id="canvas" width="490" height="330">
                        This text is displayed if your browser does not support HTML5 Canvas.
                    </canvas>
                    <canvas id="canvas2" width="490" height="330">
                        This text is displayed if your browser does not support HTML5 Canvas.
                    </canvas>
                    <div id="pool">
                        <div id="test1"></div>
                        <div id="pool_flags"></div>
                        <div id="time_counter"></div>
                    </div>
                </div>
                <div class="button-panel">
                    <button class="button-run btn btn-lg btn-secondary" onclick="runCode()">Paleisti </button>
                    <div class="hint-panel">
                        <ul> Užuomina:
                            <li>
                                <a  tabindex="0" href="javascript:void(0)" data-toggle="popover" data-placement="top" data-trigger="focus" title="" data-text='Tavo sukurta komanda turėtų būti panaši į šią:' data-full="../hints/L2T6_H1.png">1</a>
                            </li>
                            <li>
                                <a  tabindex="0" href="javascript:void(0)" data-toggle="popover" data-placement="top" data-trigger="focus" title="" data-text="Nepamiršk iškviesti sukurtos komandos! Nebent sieki plaukiojimo vietoje rekordo." data-full="../hints/L2T6_H2.png">2</a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="col" style="padding: 0 ;">
                <div id="blocklyDiv">
                </div>
                <xml id="toolbox" style="display: none">
                    <!-- <category name=b lokeliai> -->
                    <block type="krastas"></block>
                    <block type="apsisuk"></block>
                    <block type="keisti"></block>
                    <block type="controls_if"></block>
                    <block type="keisti_greiti"></block>
                    <!-- <block type="set"></block> -->
                    <block type="anim_speed"></block>
                    <block type="var_speed"></block>
                    <block type="number"></block>
                    <block type="on_click"></block>
                    <!-- <block type="controls_whileUntil"></block> -->
                    <block type="function"></block>
                    <block type="function_call"></block>
                    <!--   <block type="function_x"></block>
                    <block type="function_call_x"></block> -->
                </xml>
            </div>
            <div class="col-md-3 col-lg-2" style="height: 70vh;">
                <h5>Javascript kodas: </h5>
                <pre id="content_javascript">
                </pre>
            </div>
        </div>
        <div class="row">
            <div class="logo-row"><img src="../100/logo13.png"><img src="../100/logo12.png"><img src="../100/logo14.png"></div>
        </div>
        <div class="video-modal">
            <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-body">
                            <iframe id="iframeYoutube" width="100%" height="315" src="https://www.youtube.com/embed/9j-wTK2C-Sc " frameborder="0" allowfullscreen></iframe>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Uždaryti</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="next-modal">
            <div class="modal fade" id="nextModal" tabindex="-1" role="dialog" aria-labelledby="nextModalLabel">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-body">
                            <div>
                                <h3>Įveikta!</h3>
                            </div>
                            <div class="modal-buttons">
                                <a href="#" class="btn btn-secondary" data-dismiss="modal">Grįžti į užduotį</a>
                                <a href="level2-7.html" class="btn btn-secondary">Kita užduotis</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
    <script src="../js/bootstrap.min.js"></script>
    <script src="../js/blockly_compressed.js"></script>
    <script src="../js/javascript_compressed.js"></script>
    <script src="../js/blocks_compressed.js"></script>
    <script src="../msg/js/lt.js"></script>
    <script src="../js/main.js"></script>
    <script src="../js/baseinas.js"></script>
    <script>
    var workspace = Blockly.inject('blocklyDiv', {
        toolbox: document.getElementById('toolbox'),
        grid: {
            spacing: 20,
            length: 5,
            colour: '#f2f2f2',
            snap: true
        },
        trashcan: true
    });

    function toJavascript(event) {
        var code = Blockly.JavaScript.workspaceToCode(workspace);
        document.getElementById('content_javascript').innerHTML = code;
    }
    workspace.addChangeListener(toJavascript);
    </script>
    <script type="text/javascript">
    var my_canvas = document.getElementById("canvas");
    var ctx = my_canvas.getContext("2d");
    var my_canvas2 = document.getElementById("canvas2");
    var swimmer = my_canvas2.getContext("2d");
    var swim = new Image();
    swim.src = "../img_lessons/baseinas/plaukia_start.png";
    var swim2 = new Image();
    swim2.src = "../img_lessons/baseinas/plaukia3.png";
    var meilutyte_medal = new Image();
    meilutyte_medal.src = "../img_lessons/baseinas/meilutyte-naujas.png"


    swim.onload = function() {
        swimmer.drawImage(swim, 45, 220, 40, 40);
    };
    var start_x = 40;
    var start_y = 220;
    var x = 390;
    var startTime;
    var score;
    var speed = 0.15;
    var turn = false;
    var edge = false;
    var edge1;
    var edge2;
    var mouse_click = false;
    var swim_do = false;
    var swim_do_f = false;
    var add_speed = 0
    var add_costume_swim = false;
    var add_costume_swim2 = false;
    var costume = false;
    var animation_speed = false;
    var anim_speed = 0;


    function runCode() {
        // Generate JavaScript code and run it.
        start_x = 40;
        start_y = 220;
        speed = 0.05;
        turn = false;
        edge = false;
        edge1 = 40;
        edge2 = 380;
        mouse_click = false;
        swim_do = false;
        swim_do_f = false;
        add_speed = 0;
        add_costume_swim = false;
        add_costume_swim2 = false;
        costume = false;
        animation_speed = false;
        anim_speed = 0;
        // document.getElementById("test1").style.animationDuration = "0s";
        document.getElementById("test1").style.animationDuration = "1s"
        canvas2.removeEventListener("click", onClick, false);
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        swimmer.clearRect(0, 0, canvas.width, canvas.height);

        window.LoopTrap = 1000;
        Blockly.JavaScript.INFINITE_LOOP_TRAP =
            'if (--window.LoopTrap == 0) throw "Infinite loop.";\n';
        var code = Blockly.JavaScript.workspaceToCode(workspace);
        Blockly.JavaScript.INFINITE_LOOP_TRAP = null;
        startTime = new Date();
        swimmer.drawImage(swim, 45, 220, 70, 40);
        try {
            if (code.length > 0) {
                eval(code);

                if (mouse_click) {
                    canvas2.addEventListener("click", onClick, false);
                }

                if (swim_do && swim_do_f) {
                    if (add_costume_swim && add_costume_swim2) {
                        swimmer.clearRect(0, 0, canvas.width, canvas.height);
                        document.getElementById("test1").style.visibility = "visible";
                        // if (animation_speed) {
                        //     document.getElementById("test1").style.animationDuration = "" + (1 / anim_speed) + "s";
                        // }
                        animateSwimmer();
                    } else {
                        alert('Trūksta plaukimo judesių');
                        document.getElementById("test1").style.visibility = "hidden";
                    }


                } else {

                    alert("Ar plaukikui plaukti?");
                }

            } else {
                alert('Pridėk kodo blokelį.');
            }

        } catch (e) {
            //alert(e);
            if (e instanceof ReferenceError) {
                // statements to handle TypeError exceptions
                alert("Trūksta funkcijos");
            }

        }
    }


    function animateSwimmer() {

        //swimlID = requestAnimationFrame(animate_swimmer);

        if (start_x < edge2) {
            anim_id = requestAnimationFrame(function() { animateSwimmer(); });
        } else {
            // edge = true;
            cancelAnimationFrame(anim_id);
            if (edge && turn) {
                animateSwimmerBack();
            } else {
                alert("Baseino kraštas? Apsisuk");
            }

        }
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        swimmer.clearRect(0, 0, canvas.width, canvas.height)
        if (add_costume_swim && add_costume_swim2) {
            // switchCostumes(start_x);
            document.getElementById("test1").style.transform = "translate(" + start_x + "px, 220px)";
        } else {
            swimmer.drawImage(swim, start_x, 220, 70, 40);
        }
        drawElapsedTime();
        start_x += speed;
    }



    function animateSwimmerBack() {

        if (start_x > edge1) {
            requestAnimationFrame(function() { animateSwimmerBack(); });
        } else {

            document.getElementById("test1").style.visibility = "hidden";
            score = parseInt((new Date() - startTime) / 300);
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            swimmer.clearRect(0, 0, canvas.width, canvas.height);
            if (score < 65) {
                ctx.drawImage(meilutyte_medal, 0, 0);
                setTimeout(function() { $('#nextModal').modal('show'); }, 2000);
                return;
            } else {
                ctx.font = "14px Arial";
                ctx.fillText("Bandyk dar kartą", 195, 126);
                return;
            }

        }


        ctx.clearRect(0, 0, canvas.width, canvas.height);
        swimmer.clearRect(0, 0, canvas.width, canvas.height);
        if (add_costume_swim && add_costume_swim2) {
            document.getElementById("test1").style.transform = "translate(" + start_x + "px, 220px) scaleX(-1)";
        } else {

            swimmer.drawImage(swim2, start_x, 220, 70, 40);
        }
        start_x -= speed;
        drawElapsedTime();


    }

    function drawElapsedTime() {
        var elapsed = parseInt((new Date() - startTime) / 300);
        ctx.save();
        ctx.beginPath();
        ctx.fillStyle = "blue";
        ctx.font = "20px Arial";
        // draw the running time at half opacity
        ctx.globalAlpha = 0.50;
        ctx.fillText(elapsed + " s", 225, 126);
        ctx.restore();
    }


    function onClick(e) {

            speed += add_speed;

            if (animation_speed) { 

                anim_speed += add_speed / 10;
                if ((0.1 / anim_speed) < 1) {
                    document.getElementById("test1").style.animationDuration = "" + (0.1 / anim_speed) + "s";
                }  
            }
      

    }
    </script>
</body>

</html>