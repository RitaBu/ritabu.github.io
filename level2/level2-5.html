<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Bootstrap CSS -->
    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/style.css" rel="stylesheet">
</head>

<body>
    <div class='customAlert'>
        <p class='message'></p>
        <input type='button' class='confirmButton' value='Gerai' onclick=" $('.person_lost').hide();">
    </div>
    <div class="container-fluid header-top">
        <a href="../index.html"><img class="header_logo img-fluid" src="../img_lessons/100_small1.png"></a>
        <div class="progress-container">
            <ul style="text-align: center;">
                <li>
                    <a href="level2-1.html">1</a>
                </li>
                <li>
                    <a href="level2-2.html">2</a>
                </li>
                <li>
                    <a href="level2-3.html">3</a>
                </li>
                <li>
                    <a href="level2-4.html">4</a>
                </li>
                <li>
                    <a class="active" href="level2-5.html">5</a>
                </li>
                <li>
                    <a href="level2-6.html">6</a>
                </li>
                <li>
                    <a href="level2-7.html">7</a>
                </li>
                <li>
                    <a href="level2-8.html">8</a>
                </li>
                <li>
                    <a href="level2-9.html">9</a>
                </li>
                <li>
                    <a href="level2-10.html">10</a>
                </li>
            </ul>
        </div>
    </div>
    <div class="container-fluid working-space">
        <div class="row" style="padding: 10px;">
            <div class="col-md-5">
                <h4>5. Baltijos kelias: duokš, mielas drauge, ranką </h4></div>
            <div class=" col-md-7" id="task"> Keli žmonės pasimetė ir nežino, kur jiems atvykti. Programuojant tokius iššūkius lengvai išsprendžia sąlygos („jei ..., tai ...“). Pavyzdžiui, „jei pasuksi į kairę, tai pasieksi kelionės tikslą“. Sukurk tokias sąlygas, kad Baltijos kelyje neliktų nesusikibusių rankomis.
            Tarpas tarp žmonių - 40 cm.
                <a href="javascript:void(0)" onclick="changeVideo('qguvajOf5CE')">Užduoties video</a> </div>
        </div>
        <div class="row" style="padding: 10px">
            <div class="col ">
                <div id="preview">
                    <canvas id="canvas" width="490" height="330">
                        This text is displayed if your browser does not support HTML5 Canvas.
                    </canvas>
                    <div class="person"></div>
                    <div class="person2"></div>
                    <div class="person3"></div>
                    <div class="person_lost"></div>
                </div>
                <div class="button-panel">
                    <button class="button-run btn btn-lg btn-secondary" onclick="runCode()">Paleisti </button>
                    <div class="hint-panel">
                        <ul> Užuomina:
                            <li>
                                <a  tabindex="0" href="javascript:void(0)" data-toggle="popover" data-placement="top" data-trigger="focus" title="" data-text="Žmonių Baltijos kelyje kairė pusė nebūtinai sutampa su tavo kaire puse. Įsivaizduok, jog stovi minioje ir esi vienas iš jų.">1 </a>
                                <!-- Perkelti vyresniems -->
                            </li>
                            <li>
                                <a  tabindex="0" href="javascript:void(0)" data-toggle="popover" data-placement="top" data-trigger="focus" title="" data-text="Kiek žmonių trūksta žemiausioje eilėje? Paveikslėlyje nurodėme eilės pradžios ir pabaigos centimetrus. Pakviesk po 1 žmogų prisijungti kas 40 cm." data-full="../hints/L2T5_H2.png">2</a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="col" style="padding: 0 ;">
                <div id="blocklyDiv">
                </div>
                <xml id="toolbox" style="display: none">
                    <category name="Sąlyga" colour="230">
                        <block type="keisti2">
                        </block>
                        <!-- <block type="add_person">
                        </block> -->
                        <block type="add_person_side">
                        </block>
                        <block type="add_person2">
                        </block>
                        <block type="atstumas">
                        </block>
                    </category>
                    <category name="Ciklas" colour="120">
                        <block type="controls_for">
                            <field name="VAR" id="u-D?D6Vhel}iCy9uqmV-" variabletype="">tarpas</field>
                            <value name="FROM">
                                <shadow type="math_number">
                                    <field name="NUM">1</field>
                                </shadow>
                            </value>
                            <value name="TO">
                                <shadow type="math_number">
                                    <field name="NUM">10</field>
                                </shadow>
                            </value>
                            <value name="BY">
                                <shadow type="math_number">
                                    <field name="NUM">40</field>
                                </shadow>
                            </value>
                        </block>
                    </category>
                </xml>
            </div>
            <div class="col-md-3 col-lg-2" style="height: 70vh;">
                <h5>Javascript kodas: </h5>
                <pre id="content_javascript">
                </pre>
            </div>
        </div>
          <div class="row">
            <div class="logo-row"><img src="../100/logo13.png"><img src="../100/logo12.png"><img src="../100/logo14.png"></div>
        </div>
        <div class="video-modal">
            <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-body">
                            <iframe id="iframeYoutube" width="100%" height="315" src="https://www.youtube.com/embed/qguvajOf5CE " frameborder="0" allowfullscreen></iframe>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Uždaryti</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="next-modal">
            <div class="modal fade" id="nextModal" tabindex="-1" role="dialog" aria-labelledby="nextModalLabel">
                <div class="modal-dialog" role="document">
                   <div class="modal-content">
                        <div class="modal-body">
                            <div>
                                <h3>Susikibom!</h3>
                            </div>
                            <div class="modal-buttons">
                                <a href="#" class="btn btn-secondary" data-dismiss="modal">Grįžti į užduotį</a>
                                <a href="level2-6.html" class="btn btn-secondary">Kita užduotis</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
 <script
  src="https://code.jquery.com/jquery-3.2.1.min.js"
  integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
  crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
    <script src="../js/bootstrap.min.js"></script>
    <script src="../js/acorn_interpreter.js"></script>
    <script src="../js/blockly_compressed.js"></script>
    <script src="../js/javascript_compressed.js"></script>
    <script src="../js/blocks_compressed.js"></script>
    <script src="../msg/js/lt.js"></script>
    <script src="../js/customBlocks.js"></script>
    <script src="../js/main.js"></script>
    <script src="../js/kelias.js"></script>
    <script type="text/javascript">
    var my_canvas = document.getElementById("canvas");
    var ctx = my_canvas.getContext("2d");
    var people = new Image();
    var person110 = new Image();
    var person150 = new Image();
    var person190 = new Image();
    var person230 = new Image();
    var person270 = new Image();
    var person310 = new Image();

    people.src = "../img_lessons/baltija/fonas_sunkesnis.png";
    person110.src = "../img_lessons/baltija/1.png";
    person150.src = "../img_lessons/baltija/2.png";
    person190.src = "../img_lessons/baltija/3.png";
    person230.src = "../img_lessons/baltija/4.png";
    person270.src = "../img_lessons/baltija/5.png";
    person310.src = "../img_lessons/baltija/6.png";

    people.onload = function() {
        draw(people, 0, 0);
        ctx.strokeText("110|-------------------------------------------------------------------------|340", 100, 320);
    };

    function draw(pic_name, x, y) {
        ctx.drawImage(pic_name, x, y);
    }
    </script>
    <script>
    var workspace = Blockly.inject('blocklyDiv', {
        toolbox: document.getElementById('toolbox'),
        grid: {
            spacing: 20,
            length: 5,
            colour: '#f2f2f2',
            snap: true
        },
        trashcan: true
    });

    function toJavascript(event) {
        var code = Blockly.JavaScript.workspaceToCode(workspace);
        document.getElementById('content_javascript').innerHTML = code;
    }
    workspace.addChangeListener(toJavascript);
    </script>
    <!--     <script type="text/javascript">
    function runCode() {
        // Generate JavaScript code and run it.

        Blockly.JavaScript.STATEMENT_PREFIX = 'highlightBlock(%1);\n';
        Blockly.JavaScript.addReservedWords('highlightBlock');
        var code = Blockly.JavaScript.workspaceToCode(workspace);
        var myInterpreter = new Interpreter(code, initApi);
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        draw_elements();
        try {
            if (code.length > 0) {
                function nextStep() {
                    if (myInterpreter.step()) {
                        window.setTimeout(nextStep, 0);
                    }
                }
                nextStep();
            } else {
                alert('Pridėk kodo blokelį.');
            }

        } catch (e) {
            alert(e);
        }
    }



    function initApi(interpreter, scope) {


        // Add an API function for the alert() block.
        var wrapper = function(text) {
            text = text ? text.toString() : '';
            return interpreter.createPrimitive(alert(text));
        };
        interpreter.setProperty(scope, 'alert',
            interpreter.createNativeFunction(wrapper));

        // Add an API function for the prompt() block.
        wrapper = function(text) {
            text = text ? text.toString() : '';
            return interpreter.createPrimitive(prompt(text));
        };
        interpreter.setProperty(scope, 'prompt',
            interpreter.createNativeFunction(wrapper));
        // Add an API function for highlighting blocks.
        var wrapper = function(id) {
            id = id ? id.toString() : '';
            return interpreter.createPrimitive(Blockly.mainWorkspace.highlightBlock(id));
        };
        interpreter.setProperty(scope, 'highlightBlock',
            interpreter.createNativeFunction(wrapper));

        /*************************************************************************/
        Blockly.JavaScript.addReservedWords('updatePerson');


        var wrapper = interpreter.createAsyncFunction(


            function updatePerson(x, i, callback) {

                var lt = 30;
                var lv = 50;
                var est = 10;
                animatePerson(x, i);
                setTimeout(callback, 1000);
            }
        );
        interpreter.setProperty(scope, 'updatePerson', wrapper);
        Blockly.JavaScript.addReservedWords('lost');

        var wrapper = interpreter.createNativeFunction(
            function() {
                alert("Patikrink savo sąlygą");
            }
        );
        interpreter.setProperty(scope, 'lost', wrapper);


        Blockly.JavaScript.addReservedWords('waitForSeconds');

        var wrapper = interpreter.createAsyncFunction(
            function(timeInSeconds, callback) {
                // Delay the call to the callback.
                setTimeout(callback, timeInSeconds * 1000);
            });
        interpreter.setProperty(scope, 'waitForSeconds', wrapper);

    }
    </script> -->
    <script type="text/javascript">
    function runCode() {
        done = [];

        // Generate JavaScript code and run it.
        window.LoopTrap = 1000;
        Blockly.JavaScript.INFINITE_LOOP_TRAP =
            'if (--window.LoopTrap == 0) throw "Infinite loop.";\n';
        var code = Blockly.JavaScript.workspaceToCode(workspace);
        Blockly.JavaScript.INFINITE_LOOP_TRAP = null;
        // step = 0;
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        draw(people, 0, 0);
        ctx.strokeText("110|-------------------------------------------------------------------------|340", 100, 320);

        $('.person').hide().removeAttr('style');
        $('.person2').hide().removeAttr('style');
        // $('.person3').hide().removeAttr('style');
        try {
            if (code.length > 0) {
                eval(code);
                  console.log(done);
                if (done.join('').split('').length == 8) { setTimeout(function() { $('#nextModal').modal('show'); }, 3000);}
            } else {
                alert('Pridėk kodo blokelį.');
            }

        } catch (e) {
            alert('Klaida! Patikrink blokelius');
        }
    }
    </script>
</body>

</html>