<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Bootstrap CSS -->
    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/style.css" rel="stylesheet">
</head>

<body>
        <div class='customAlert'>
        <p class='message'></p>
        <input type='button' class='confirmButton' value='OK'>
    </div>
    <div class="container-fluid header-top">
        <a href="../index.html"><img class="header_logo img-fluid" src="../img_lessons/100_small1.png"></a>
        <div class="progress-container">
            <ul style="text-align: center;">
                <li>
                    <a href="level1-1.html">1</a>
                </li>
                <li>
                    <a class="active" href="level1-2.html">2</a>
                </li>
                <li>
                    <a href="level1-3.html">3</a>
                </li>
                <li>
                    <a href="level1-4.html">4</a>
                </li>
                <li>
                    <a href="level1-5.html">5</a>
                </li>
                <li>
                    <a href="level1-6.html">6</a>
                </li>
                <li>
                    <a href="level1-7.html">7</a>
                </li>
                <li>
                    <a href="level1-8.html">8</a>
                </li>
                <li>
                    <a href="level1-9.html">9</a>
                </li>
                <li>
                    <a href="level1-10.html">10</a>
                </li>
            </ul>
        </div>
    </div>
    <div class="container-fluid working-space">
        <div class="row" style="padding: 10px;">
            <div class="col-md-5">
                <h4>2. LITUANICA: Two Friends</h4></div>
            <div class=" col-md-7" id="task"> Re-create the historic flight of Darius and Girėnas across the Atlantic Ocean and help them reach their destination. Their started in New York, continued over Newfoundland, Scotland and, sadly, ended somewhere within the modern Poland territory. Program their route by connecting the blocks and pointing them to the right direction. Once you reach the fatal point in Poland, help the pilots reach Kaunas. 
                <!-- <a href="javascript:void(0)" onclick="changeVideo('f6R89D9RLn4')">Task Video</a>  -->
            </div>
        </div>
        <div class="row" style="padding: 10px">
            <div class="col  ">
                <div id="preview">
                    <canvas id="canvas" width="490" height="330" style="z-index: 0">
                        This text is displayed if your browser does not support HTML5 Canvas.
                    </canvas>
                    <canvas id="canvas3" width="490" height="330">
                        This text is displayed if your browser does not support HTML5 Canvas.
                    </canvas>
                    <div id="lituanica_plane"></div>
                </div>
                <div class="button-panel">
                    <button class="button-run btn btn-lg btn-secondary" onclick="runCode()">Play </button>
                    <div class="hint-panel">
                        <ul> Hint:
                <!--             <li>
                                <a tabindex="0" href="javascript:void(0)" data-toggle="popover" data-placement="top" data-trigger="focus" title="" data-text=" Imagine that you are the plane pilot - this will make it easier to find right and left side.">1</a>
                               
                            </li> -->
                            <li>
                                <a tabindex="0"  href="javascript:void(0)" data-toggle="popover" data-placement="top" data-trigger="focus" title="" data-text="Did you visit all the points of the journey? Once you have finished recreating the route, continue to the planned destination - Kaunas. " data-full="../hints/L1T2_H2.png">1</a>
                                <!-- https://drive.google.com/file/d/1udySRTWwxen0BUmGSVjwEqwb5q04YJAu/view -->
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="col" style="padding: 0 ;">
                <div id="blocklyDiv">
                </div>
                <xml id="toolbox" style="display: none">
                    <block type="fly_left">
                    </block>
                    <block type="fly_right">
                    </block>
                    <block type="fly_straight">
                    </block>
                    <block type="blocks">
                    </block>
                </xml>
            </div>
            <div class="col-md-3 col-lg-2" style="height: 70vh;">
                <h5>Javascript code: </h5>
                <pre id="content_javascript">
                </pre>
            </div>
        </div>
          <div class="row">
            <div class="logo-row"><img src="../100/logo13.png"><img src="../100/logo12.png"><img src="../100/logo14.png"></div>
        </div>
<!--         <div class="video-modal">
            <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-body">
                            <iframe id="iframeYoutube" width="100%" height="315" src="https://www.youtube.com/embed/f6R89D9RLn4  " frameborder="0" allowfullscreen></iframe>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Uždaryti</button>
                        </div>
                    </div>
                </div>
            </div>
        </div> -->
        <div class="next-modal">
            <div class="modal fade" id="nextModal" tabindex="-1" role="dialog" aria-labelledby="nextModalLabel">
                <div class="modal-dialog" role="document">
                   <div class="modal-content">
                        <div class="modal-body">
                            <div>
                                <h3>Arrival!</h3>
                            </div>
                            <div class="modal-buttons">
                                <a href="#" class="btn btn-secondary" data-dismiss="modal">Back to task</a>
                                <a href="level1-3.html" class="btn btn-secondary">Next task</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <img style="visibility: hidden;">
    </div>
    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
    <script src="../js/bootstrap.min.js"></script>
    <script src="../js/acorn_interpreter.js"></script>
    <script src="../js/blockly_compressed.js"></script>
    <script src="../js/javascript_compressed.js"></script>
    <script src="../js/blocks_compressed.js"></script>
    <script src="../msg/js/en.js"></script>
    <script src="../js/main.js"></script>
    <script src="../js/lituanica.js"></script>
    <script type="text/javascript">
    var my_canvas = document.getElementById("canvas");
    var background = my_canvas.getContext("2d");
    var map = new Image();
    map.src = "../img_lessons/lituanica/fonas.png";
    var plane = new Image();
    plane.src = "../img_lessons/lituanica/lituanica_didelis.png";
    var plain_x = 0;
    var plain_y = 170;
    var finished = false;
    var points = [];

    map.onload = function() {
        //draw(map, 0, 0, 500,300);

        background.drawImage(map, 0, 0);
        drawGrid();

    }

    function drawGrid() {
        background.strokeStyle = 'grey';
        for (i = 0; i < 490; i += 40) {
            background.beginPath();
            background.moveTo(i, 0);
            background.lineTo(i, 330);
            background.stroke();
        }
        for (i = 10; i < 330; i += 40) {
            background.beginPath();
            background.moveTo(0, i);
            background.lineTo(490, i);
            background.stroke();
        }
        background.strokeStyle = 'black';
         background.font = "12px Verdana";
        //newyork
        background.fillRect(45, 190, 4, 4);
        background.beginPath();
        background.arc(47, 192, 8, 0, 2 * Math.PI);
        background.strokeText("New York", 40, 210);
        background.stroke();
        //newfoundland
        background.fillRect(130, 140, 4, 4);
        background.beginPath();
        background.arc(132, 142, 8, 0, 2 * Math.PI);

        background.stroke();
        //Škotija
        background.fillRect(330, 105, 4, 4);
        background.beginPath();
        background.arc(332, 107, 8, 0, 2 * Math.PI);

        background.stroke();
        //Kaunas
        background.fillRect(449, 122, 4, 4);
        background.beginPath();
        background.arc(451, 124, 8, 0, 2 * Math.PI);
        background.stroke();
        //Lenkija, ex Vokietija, 
        background.fillRect(410, 140, 4, 4);
        background.beginPath();
        background.strokeStyle = '#ff0000';
        background.arc(412, 142, 8, 0, 2 * Math.PI);
        background.stroke();


    }
    </script>
    <script>
    var workspace = Blockly.inject('blocklyDiv', {
        toolbox: document.getElementById('toolbox'),
        grid: {
            spacing: 20,
            length: 5,
            colour: '#f2f2f2',
            snap: true
        },
        trashcan: true
    });

    function toJavascript(event) {
        var code = Blockly.JavaScript.workspaceToCode(workspace);
        document.getElementById('content_javascript').innerHTML = code;
    }
    workspace.addChangeListener(toJavascript);
    </script>
    <script type="text/javascript">
    var globalID;

    function runCode() {
        cancelAnimationFrame(globalID);

        Blockly.JavaScript.STATEMENT_PREFIX = 'highlightBlock(%1);\n';
        Blockly.JavaScript.addReservedWords('highlightBlock');
        var code = Blockly.JavaScript.workspaceToCode(workspace);
        var myInterpreter = new Interpreter(code, initApi);

        background.clearRect(0, 0, canvas.width, canvas.height);
        background.strokeStyle = "black";
        background.drawImage(map, 0, 0);
        drawGrid();
        plain_x = 0;
        plain_y = 170;
        var x = 0;
        var y = 0;
        var move = 0;
        finished = false;
        points = [];
        document.getElementById("lituanica_plane").style.visibility = 'visible';
        document.getElementById("lituanica_plane").style.transform = "translate(0px, 170px)";


        try {

            if (code.length > 0) {
                //eval(code);
                function nextStep() {
                    if (myInterpreter.step()) {
                        window.setTimeout(nextStep, 0);
                    }
                }
                nextStep();
                // myInterpreter.run();
            } else {
                alert('Add code block.');
            }

        } catch (e) {
             alert('Error! Please check the blocks.');
        }
    }


    function initApi(interpreter, scope) {

        // Add an API function for the alert() block.
        var wrapper = function(text) {
            text = text ? text.toString() : '';
            return interpreter.createPrimitive(alert(text));
        };
        interpreter.setProperty(scope, 'alert',
            interpreter.createNativeFunction(wrapper));

        // Add an API function for the prompt() block.
        wrapper = function(text) {
            text = text ? text.toString() : '';
            return interpreter.createPrimitive(prompt(text));
        };
        interpreter.setProperty(scope, 'prompt',
            interpreter.createNativeFunction(wrapper));
        // Add an API function for highlighting blocks.
        var wrapper = function(id) {
            id = id ? id.toString() : '';
            return interpreter.createPrimitive(Blockly.mainWorkspace.highlightBlock(id));
        };
        interpreter.setProperty(scope, 'highlightBlock',
            interpreter.createNativeFunction(wrapper));

        /***********************************************************************/

        Blockly.JavaScript.addReservedWords('updatePlane');

        var wrapper = interpreter.createAsyncFunction(
            function updatePlane(x, y, callback) {
                changePoints(x, y);
                callback();
            }
        );
        interpreter.setProperty(scope, 'updatePlane', wrapper);
        /***********************************************************************/

        /*************************************************************************/
        Blockly.JavaScript.addReservedWords('waitForSeconds');

        var wrapper = interpreter.createAsyncFunction(
            function(timeInSeconds, callback) {
                // Delay the call to the callback.
                setTimeout(callback, timeInSeconds * 1000);
            });
        interpreter.setProperty(scope, 'waitForSeconds', wrapper);

    }
    </script>
</body>

</html>