<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Bootstrap CSS -->
    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/style.css" rel="stylesheet">
</head>

<body>
    <div class='customAlert'>
        <p class='message'></p>
        <input type='button' class='confirmButton' value='OK'>
    </div>
    <div class="container-fluid header-top">
        <a href="../index.html"><img class="header_logo img-fluid" src="../img_lessons/100_small1.png"></a>
        <div class="progress-container">
            <ul style="text-align: center;">
                <li>
                    <a href="level2-1.html">1</a>
                </li>
                <li>
                    <a href="level2-2.html">2</a>
                </li>
                <li>
                    <a href="level2-3.html">3</a>
                </li>
                <li>
                    <a href="level2-4.html">4</a>
                </li>
                <li>
                    <a href="level2-5.html">5</a>
                </li>
                <li>
                    <a href="level2-6.html">6</a>
                </li>
                <li>
                    <a href="level2-7.html">7</a>
                </li>
                <li>
                    <a class="active" href="level2-8.html">8</a>
                </li>
                <li>
                    <a href="level2-9.html">9</a>
                </li>
                <li>
                    <a href="level2-10.html">10</a>
                </li>
            </ul>
        </div>
    </div>
    <div class="container-fluid working-space">
        <div class="row" style="padding: 10px;">
            <div class="col-md-5">
                <h4>8. Šakotis For Sale</h4></div>
            <div class=" col-md-7" id="task">
                Earn some Euros, convert them into Litas, early 90's currency Talonas, then interwar period Litas and buy a Šakotis cake. While programming, specify that Euros are received after <b>clicking on the Euro coin</b> and the other currencies are converted accordingly after <b>clicking on them</b>. After collecting the right amount of interwar period Litas (in the task - tarpukario litai) click the “PIRKTI”, or “Purchase”, button and taste! Playful exchange rates are in the hint!
                <!-- <a href="javascript:void(0)" onclick="changeVideo('3GHeJUeor5A')">Užduoties video</a>  -->
            </div>
        </div>
        <div class="row" style="padding: 10px">
            <div class="col  ">
                <div id="preview">
                    <canvas id="canvas" width="490" height="330">
                        This text is displayed if your browser does not support HTML5 Canvas.
                    </canvas>
                </div>
                <div class="button-panel">
                    <button class="button-run btn btn-lg btn-secondary" onclick="runCode()">Play </button>
                    <div class="hint-panel">
                        <ul> Hint:
                            <li>
                                <a  tabindex="0" href="javascript:void(0)" data-toggle="popover" data-placement="top" data-trigger="focus" title="" data-text="Task currency rate: 1 EUR = 3.45 LT; 1 LT = 100 Talonai; 1 Talonas = 0,006 Interwar Period LT. Use multiplication function and full stop instead of comma. ">1</a>
                            </li>
                            <li>
                                <a  tabindex="0" href="javascript:void(0)" data-toggle="popover" data-placement="top" data-trigger="focus" title="" data-text="An example of currency conversion program:" data-full="../hints/L2T8_H2.png">2</a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="col" style="padding: 0 ;">
                <div id="blocklyDiv">
                </div>
                <xml id="toolbox" style="display: none">
                    <category name="Currency" colour="230">
                        <block type="math_arithmetic">
                            <value name="A">
                                <shadow type="math_number">
                                    <field name="NUM">1</field>
                                </shadow>
                            </value>
                            <value name="B">
                                <shadow type="math_number">
                                    <field name="NUM">1</field>
                                </shadow>
                            </value>
                        </block>
                        <block type="paspausta"></block>
                        <!-- <block type="keisti_valiuta"> </block> -->
                        <block type="kintamieji"></block>
                        <block type="set"></block>
                        <block type="change"></block>
                        <block type="ifas"></block>
                    </category>
                </xml>
            </div>
            <div class="col-md-3 col-lg-2" style="height: 70vh;">
                <h5>Javascript code: </h5>
                <pre id="content_javascript">
                </pre>
            </div>
        </div>
          <div class="row">
            <div class="logo-row"><img src="../100/logo13.png"><img src="../100/logo12.png"><img src="../100/logo14.png"></div>
        </div>
<!--         <div class="video-modal">
            <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-body">
                            <iframe id="iframeYoutube" width="100%" height="315" src="https://www.youtube.com/embed/3GHeJUeor5A " frameborder="0" allowfullscreen></iframe>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Uždaryti</button>
                        </div>
                    </div>
                </div>
            </div>
        </div> -->
        <div class="next-modal">
            <div class="modal fade" id="nextModal" tabindex="-1" role="dialog" aria-labelledby="nextModalLabel">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-body">
                            <div>
                                <h3>Success!</h3>
                            </div>
                            <div class="modal-buttons">
                                <a href="#" class="btn btn-secondary" data-dismiss="modal">Back to task</a>
                                <a href="level2-9.html" class="btn btn-secondary">Next task</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
    <script src="../js/bootstrap.min.js"></script>
    <script src="../js/blockly_compressed.js"></script>
    <script src="../js/javascript_compressed.js"></script>
    <script src="../js/blocks_compressed.js"></script>
    <script src="../msg/js/en.js"></script>
    <script src="../js/main.js"></script>
    <script src="../js/litai_2.js"></script>
    <script>
    var workspace = Blockly.inject('blocklyDiv', {
        toolbox: document.getElementById('toolbox'),
        grid: {
            spacing: 20,
            length: 5,
            colour: '#f2f2f2',
            snap: true
        },
        trashcan: true
    });

    function toJavascript(event) {
        var code = Blockly.JavaScript.workspaceToCode(workspace);
        document.getElementById('content_javascript').innerHTML = code;
    }
    workspace.addChangeListener(toJavascript);
    </script>
    <script type="text/javascript">
    var my_canvas = document.getElementById("canvas");
    var ctx = my_canvas.getContext("2d");
    var background = new Image();
    background.src = "../img_lessons/valiutos/level2-bg.jpg";
    my_canvas.addEventListener('click', clickReporterPirkti, false);
    var eurasKainuoja = 3.45;
    var litas;
    var euras;
    var talonas;
    var litas_old;
    var paspausta;
    var callAgain;
    var win = new Image();
    win.src = "../img_lessons/valiutos/win.jpg";

    background.onload = function() {
        draw(background, 0, 0);
    };

    var clicked;

    function runCode() {
        // Generate JavaScript code and run it.
        window.LoopTrap = 1000;
        Blockly.JavaScript.INFINITE_LOOP_TRAP =
            'if (--window.LoopTrap == 0) throw "Infinite loop.";\n';
        var code = Blockly.JavaScript.workspaceToCode(workspace);
        Blockly.JavaScript.INFINITE_LOOP_TRAP = null;
        // my_canvas.removeEventListener('click', clicked, false);
        $('canvas').off("click", clicked);
        litas = 0;
        euras = 0;
        talonas = 0;
        litas_old = 0;
        draw_elements();
        try {
            if (code.length > 0) {
                eval(code);
            } else {
                alert('Add code block.');
            }

        } catch (e) {
             alert('Error! Please check the blocks.');
        }
    }

    function draw(pic_name, x, y) {
        ctx.drawImage(pic_name, x, y);
    }

    function draw_elements() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        draw(background, 0, 0);
        ctx.font = "16px Verdana";
        ctx.strokeText(euras, 150, 170);
        ctx.strokeText((Math.round(litas * 100) / 100), 195, 52);
        ctx.strokeText((Math.round(talonas * 100) / 100), 425, 52);
        ctx.strokeText((Math.round(litas_old * 100) / 100), 410, 180);
    }

    function callAgain(if_body) {

        // clicked = function(e) { clickReporter(e, if_body) };
        // my_canvas.addEventListener('click', clicked);
        $('canvas').on("click", function clicked(e) { clickReporter(e, if_body) });

    };

    function clickReporter(e, if_body) { /// assign event to some variable

        /// adjust mouse click position to be relative to canvas:
        var rect = canvas.getBoundingClientRect(),
            x = e.clientX - rect.left,
            y = e.clientY - rect.top;
        euras_width = 90;
        euras_height = 90;
        litas_width = 150;
        litas_height = 80;
        talonas_width = 140;
        talonas_height = 80;
        litas_old_width = 150;
        litas_old_height = 80;


        /// check x/y coordinate against the image position and dimension
        //button litas
        if (x >= 30 && x <= (30 + litas_width) &&
            y >= 30 && y <= (30 + litas_height)) {

            //exchangeLitai();
            paspausta = "litai";
            if_body();
            draw_elements();

        }
        //button_1 talonas
        if (x >= 270 && x <= (270 + talonas_width) &
            y >= 21 && y <= (21 + talonas_height)) {

            //exchangeLitai();
            paspausta = "talonas";
            if_body();
            draw_elements();

        }
        //button_2 litas(23m.)
        if (x >= 230 && x <= (230 + litas_old_width) &&
            y >= 125 && y <= (125 + litas_old_height)) {

            //exchangeLitai();
            paspausta = "litas_old";
            if_body();
            draw_elements();

        }
        //button_euras
        if (x >= 45 && x <= (45 + euras_width) &&
            y >= 125 && y <= (125 + euras_height)) {

            // exchangeLitai();
            paspausta = "eurai";
            if_body();
            draw_elements();
        }
    }

    function clickReporterPirkti(e) { /// assign event to some variable

        /// adjust mouse click position to be relative to canvas:
        var rect = this.getBoundingClientRect(),
            x = e.clientX - rect.left,
            y = e.clientY - rect.top;

        buy_width = 145;
        buy_height = 65
        if (x >= 320 && x <= (320 + buy_width) &&
            y >= 244 && y <= (244 + buy_height)) {

            if (litas != 0 && euras != 0 && talonas != 0 && litas_old != 0) {
                if (litas_old > 30) {
                    ctx.clearRect(0, 0, 10, 10);
                    draw(win, 0, 0);
                    // ctx.strokeText("NUSIPIRKAI", 200, 100);
                    setTimeout(function() { $('#nextModal').modal('show'); }, 2000);
                } else {

                    litas = 0;
                    euras = 0;
                    talonas = 0;
                    litas_old = 0;
                    draw_elements();
                    ctx.strokeText("NOT ENOUGH", 200, 300);
                }
            } else {
                alert('Convert all currencies');
            }
        }
    }
    </script>
</body>

</html>