<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Bootstrap CSS -->
    <link href="../css/bootstrap.min.css"
        rel="stylesheet">
    <link href="../css/style.css"
        rel="stylesheet">
</head>

<body>
    <div class='customAlert'>
        <p class='message'></p>
        <input type='button'
            class='confirmButton'
            value='Gerai'>
    </div>
    <div class="container-fluid header-top">
        <a href="../index.html">
            <img class="header_logo img-fluid" src="../img_lessons/100_small1.png">
        </a>
        <div class="progress-container">
            <ul style="text-align: center;">
                <li>
                    <a href="level1-1.html">1</a>
                </li>
                <li>
                    <a class="active"
                        href="level1-2.html">2</a>
                </li>
                <li>
                    <a href="level1-3.html">3</a>
                </li>
                <li>
                    <a href="level1-4.html">4</a>
                </li>
                <li>
                    <a href="level1-5.html">5</a>
                </li>
                <li>
                    <a href="level1-6.html">6</a>
                </li>
                <li>
                    <a href="level1-7.html">7</a>
                </li>
                <li>
                    <a href="level1-8.html">8</a>
                </li>
                <li>
                    <a href="level1-9.html">9</a>
                </li>
                <li>
                    <a href="level1-10.html">10</a>
                </li>
            </ul>
        </div>
    </div>
    <div class="container-fluid working-space">
        <div class="row"
            style="padding: 10px;">
            <div class="col-md-5">
                <h4>2. Dodies ceļā, Milda</h4>
            </div>
            <div class=" col-md-7"
                id="task">
                Palīdzi Mildai apceļot visus četrus Latvijas novadus un tajos esošos dabas brīnumus. Viņas ceļojums sākas Rīgā, tālāk viņa dodas uz Jūrkalni Kurzemē, Tērvetes dabas parku Zemgalē, Daugavas lokiem Latgalē un Gaujas Nacionālo parku Vidzemē. Programmē viņas
                ceļu, savienojot blokus un norādot viņai pareizo virzienu, tā, lai būtu apmeklētas visas četras vietas.
            </div>
        </div>
        <div class="row"
            style="padding: 10px">
            <div class="col  ">
                <div id="preview">
                    <canvas id="canvas"
                        width="490"
                        height="330"
                        style="z-index: 0">
                        This text is displayed if your browser does not support HTML5 Canvas.
                    </canvas>
                    <canvas id="canvas3"
                        width="490"
                        height="330">
                        This text is displayed if your browser does not support HTML5 Canvas.
                    </canvas>
                    <div id="milda"></div>
                </div>
                <div class="button-panel">
                    <button class="button-run btn btn-lg btn-secondary"
                        onclick="runCode()">Starts </button>
                    <div class="hint-panel">
                        <ul> Norāde:
                            <li>
                                <a tabindex="0"
                                    href="javascript:void(0)"
                                    data-toggle="popover"
                                    data-placement="top"
                                    data-trigger="focus"
                                    title=""
                                    data-text="Iztēlojies, ka esi ceļotājs – tas ļaus vieglāk noteikt labo un kreiso pusi.">
                                    1
                                </a>
                            </li>
                            <li>
                                <a tabindex="0"
                                    href="javascript:void(0)"
                                    data-toggle="popover"
                                    data-placement="top"
                                    data-trigger="focus"
                                    title=""
                                    data-text="Vai apmeklēji visas četras ceļojuma vietas?"
                                    data-full="../hints/L1T2_H2.png">
                                    2
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="col"
                style="padding: 0 ;">
                <div id="blocklyDiv">
                </div>
                <xml id="toolbox"
                    style="display: none">
                    <block type="go_left">
                    </block>
                    <block type="go_right">
                    </block>
                    <block type="go_straight">
                    </block>
                    <block type="go_back">
                    </block>
                    <block type="blocks">
                    </block>
                </xml>
            </div>
            <div class="col-md-3 col-lg-2"
                style="height: 70vh;">
                <h5>Javascript kods: </h5>
                <pre id="content_javascript">
                </pre>
            </div>
        </div>
        <div class="next-modal">
            <div class="modal fade"
                id="nextModal"
                tabindex="-1"
                role="dialog"
                aria-labelledby="nextModalLabel">
                <div class="modal-dialog"
                    role="document">
                    <div class="modal-content">
                        <div class="modal-body">
                            <div>
                                <h3>Galamērķis sasniegts!</h3>
                            </div>
                            <div class="modal-buttons">
                                <a href="#"
                                    class="btn btn-secondary"
                                    data-dismiss="modal">Doties atpakaļ uz uzdevumu</a>
                                <a href="level1-3.html"
                                    class="btn btn-secondary">Nākamais uzdevums</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <img style="visibility: hidden;">
    </div>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
        integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js"
        integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4"
        crossorigin="anonymous"></script>
    <script src="../js/bootstrap.min.js"></script>
    <script src="../js/acorn_interpreter.js"></script>
    <script src="../js/blockly_compressed.js"></script>
    <script src="../js/javascript_compressed.js"></script>
    <script src="../js/blocks_compressed.js"></script>
    <script src="../msg/js/lv.js"></script>
    <script src="../js/main.js"></script>
    <script src="../js/milda.js"></script>
    <script type="text/javascript">
        var my_canvas = document.getElementById("canvas");
        var background = my_canvas.getContext("2d");
        var map = new Image();
        map.src = "../img_lessons/milda/background.png";
        var map2 = new Image();
        map2.src = "../img_lessons/milda/background2.png";
        var m_done = new Image();
        m_done.src = "../img_lessons/milda/milda-done.png";
        var plain_x = 180;
        var plain_y = 75;
        var finished = false;
        var points = [];

        map.onload = function() {
            //draw(map, 0, 0, 500,300);

            background.drawImage(map, 0, 0);
            drawGrid();

        }

        function drawGrid() {
            background.strokeStyle = 'grey';
            for (i = -2; i < 490; i += 40) {
                background.beginPath();
                background.moveTo(i, 0);
                background.lineTo(i, 330);
                background.stroke();
            }
            for (i = 12; i < 330; i += 40) {
                background.beginPath();
                background.moveTo(0, i);
                background.lineTo(490, i);
                background.stroke();
            }
            background.strokeStyle = 'black';
            background.font = "14px Arial";

            background.fillRect(45, 145, 4, 4);
            background.beginPath();
            background.arc(47, 147, 12, 0, 2 * Math.PI);
            if (points[0] == 1) {
                background.strokeText("Jūrkalne", 25, 125);
            }
            //background.strokeText("Jūrkalne", 25, 125);
            background.stroke();

            background.fillRect(165, 205, 4, 4);
            background.beginPath();
            background.arc(167, 207, 12, 0, 2 * Math.PI);
            if (points[1] == 1) {
                background.strokeText("Tervete nature park", 120, 190);
            }
            background.stroke();

            background.fillRect(280, 98, 4, 4);
            background.beginPath();
            background.arc(282, 100, 12, 0, 2 * Math.PI);
            if (points[2] == 1) {
                background.strokeText("Gauja", 265, 80);
            }
            background.stroke();

            background.fillRect(380, 270, 4, 4);
            background.beginPath();
            background.arc(382, 272, 12, 0, 2 * Math.PI);
            if (points[3] == 1) {
                background.strokeText("Daugavas loki", 340, 255);
            }
            background.stroke();

            background.fillRect(200, 155, 4, 4);
            background.beginPath();
            // background.strokeStyle = '#ff0000';
            background.arc(202, 157, 12, 0, 2 * Math.PI);
            background.strokeText("Ryga", 185, 140);
            background.stroke();
        }
    </script>
    <script>
        var workspace = Blockly.inject('blocklyDiv', {
            toolbox: document.getElementById('toolbox'),
            grid: {
                spacing: 20,
                length: 5,
                colour: '#f2f2f2',
                snap: true
            },
            trashcan: true
        });

        function toJavascript(event) {
            var code = Blockly.JavaScript.workspaceToCode(workspace);
            document.getElementById('content_javascript').innerHTML = code;
        }
        workspace.addChangeListener(toJavascript);
    </script>
    <script type="text/javascript">
        var globalID;

        function runCode() {
            cancelAnimationFrame(globalID);

            Blockly.JavaScript.STATEMENT_PREFIX = 'highlightBlock(%1);\n';
            Blockly.JavaScript.addReservedWords('highlightBlock');
            var code = Blockly.JavaScript.workspaceToCode(workspace);
            var myInterpreter = new Interpreter(code, initApi);
            points = [];
            background.clearRect(0, 0, canvas.width, canvas.height);
            background.strokeStyle = "black";
            background.drawImage(map, 0, 0);
            drawGrid();
            plain_x = 180;
            plain_y = 75;
            var x = 0;
            var y = 0;
            var move = 0;
            finished = false;
            document.getElementById("milda").style.visibility = 'visible';
            document.getElementById("milda").style.transform = "translate(180px, 75px)";


            try {

                if (code.length > 0) {
                    //eval(code);
                    function nextStep() {
                        if (myInterpreter.step()) {
                            window.setTimeout(nextStep, 0);
                        }
                    }
                    nextStep();
                } else {
                    alert('Pievienot bloku.');
                }

            } catch (e) {
                alert('Kļūda! Lūdzu, pārbaudi blokus');
            }
        }


        function initApi(interpreter, scope) {

            // Add an API function for the alert() block.
            var wrapper = function(text) {
                text = text ? text.toString() : '';
                return interpreter.createPrimitive(alert(text));
            };
            interpreter.setProperty(scope, 'alert',
                interpreter.createNativeFunction(wrapper));

            // Add an API function for the prompt() block.
            wrapper = function(text) {
                text = text ? text.toString() : '';
                return interpreter.createPrimitive(prompt(text));
            };
            interpreter.setProperty(scope, 'prompt',
                interpreter.createNativeFunction(wrapper));
            // Add an API function for highlighting blocks.
            var wrapper = function(id) {
                id = id ? id.toString() : '';
                return interpreter.createPrimitive(Blockly.mainWorkspace.highlightBlock(id));
            };
            interpreter.setProperty(scope, 'highlightBlock',
                interpreter.createNativeFunction(wrapper));

            /***********************************************************************/

            Blockly.JavaScript.addReservedWords('updateMilda');

            var wrapper = interpreter.createAsyncFunction(
                function updateMilda(x, y, callback) {
                    changePoints(x, y);
                    callback();
                }
            );
            interpreter.setProperty(scope, 'updateMilda', wrapper);
            /***********************************************************************/

            /*************************************************************************/
            Blockly.JavaScript.addReservedWords('waitForSeconds');

            var wrapper = interpreter.createAsyncFunction(
                function(timeInSeconds, callback) {
                    // Delay the call to the callback.
                    setTimeout(callback, timeInSeconds * 1000);
                });
            interpreter.setProperty(scope, 'waitForSeconds', wrapper);

        }
    </script>
</body>

</html>